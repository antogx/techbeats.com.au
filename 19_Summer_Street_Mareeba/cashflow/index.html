<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cashflow and Capital Growth Calculator</title>
  <style>
    :root{
      --bg: #fbf7ef;
      --text: #1f2937;
      --muted: #6b7280;

      --blue: #1f6feb;
      --green:#1f9d55;
      --brown:#7a4b2a;
      --gold:#c9a227;
      --grey:#8a9099;

      --border: rgba(201,162,39,.95);
      --border2: rgba(201,162,39,.55);

      --shadow: 0 14px 34px rgba(31,41,55,.12);
      --shadow2: 0 8px 18px rgba(31,41,55,.10);

      --radius: 18px;
      --radius2: 12px;

      --focus: rgba(31,111,235,.28);

      --danger: #b42318;
      --ok: #067647;

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    [data-theme="dark"]{
      --bg: #0b1220;
      --text: #f2f4f7;
      --muted: #a6b0c3;

      --blue: #79c0ff;
      --green:#7ee787;
      --brown:#d2a07a;
      --gold:#ffd36a;
      --grey:#cbd5e1;

      --border: rgba(255,211,106,.95);
      --border2: rgba(255,211,106,.55);

      --shadow: 0 14px 34px rgba(0,0,0,.35);
      --shadow2: 0 8px 18px rgba(0,0,0,.28);

      --focus: rgba(121,192,255,.25);
      --danger: #ff8b8b;
      --ok: #8ef0b0;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: var(--sans);
      font-size: 18px;
      color: var(--text);
      -webkit-text-size-adjust: 100%;
      overflow-x: hidden;

      background:
        radial-gradient(900px 520px at 12% 8%, rgba(31,111,235,.22), transparent 60%),
        radial-gradient(900px 520px at 88% 10%, rgba(31,157,85,.18), transparent 60%),
        radial-gradient(900px 620px at 88% 92%, rgba(122,75,42,.18), transparent 62%),
        radial-gradient(900px 520px at 12% 92%, rgba(201,162,39,.10), transparent 62%),
        var(--bg);
    }

    header{
      position: sticky;
      top: 0;
      z-index: 20;
      backdrop-filter: blur(10px);
      background: rgba(251,247,239,.78);
      border-bottom: 2px solid var(--border2);
    }
    [data-theme="dark"] header{ background: rgba(11,18,32,.78); }

    .header-inner{
      max-width: 1250px;
      margin: 0 auto;
      padding: 14px 14px;
      display:flex;
      align-items:flex-start;
      justify-content: space-between;
      gap: 12px;
    }

    h1{
      margin:0;
      font-size: clamp(24px, 2.8vw, 36px);
      line-height: 1.1;
      letter-spacing: .2px;
    }

    .header-right{
      display:flex;
      align-items:center;
      gap: 12px;
      justify-content:flex-end;
    }

    .icon-btn{
      appearance:none;
      border: 2px solid var(--border);
      background: rgba(255,250,240,.88);
      color: var(--text);
      border-radius: 999px;
      padding: 11px 14px;
      display:flex;
      align-items:center;
      gap: 10px;
      cursor:pointer;
      box-shadow: var(--shadow2);
      touch-action: manipulation;
      user-select:none;
      min-height: 50px;
      font-weight: 900;
      font-size: 16px;
    }
    [data-theme="dark"] .icon-btn{ background: rgba(15,26,46,.88); }
    .icon-btn:active{transform: translateY(1px)}
    .icon{width: 18px; height: 18px; display:inline-block}
    .icon svg{width:100%; height:100%}

    .logo-preview{
      width: 150px;
      height: 150px;
      border-radius: 18px;
      border: 3px solid var(--border);
      background: rgba(255,250,240,.90);
      overflow:hidden;
      box-shadow: var(--shadow2);
      display:grid;
      place-items:center;
      flex: 0 0 auto;
    }
    [data-theme="dark"] .logo-preview{ background: rgba(15,26,46,.90); }
    .logo-preview img{width:100%; height:100%; object-fit:contain; display:block;}

    .container{
      max-width: 1250px;
      margin: 0 auto;
      padding: 18px 14px 44px;
    }

    .stack{display:flex; flex-direction:column; gap: 14px; margin-top: 16px;}
    .two-col{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }

    .card{
      border-radius: 18px;
      border: 3px solid var(--border);
      box-shadow: var(--shadow);
      padding: 16px;
      min-width: 0;
      background: rgba(255,250,240,.92);
    }
    [data-theme="dark"] .card{ background: rgba(15,26,46,.92); }

    .tint-details{
      border-width: 4px;
      box-shadow: 0 16px 44px rgba(31,111,235,.18), var(--shadow);
      background:
        linear-gradient(180deg, rgba(31,111,235,.10), transparent 55%),
        rgba(255,250,240,.92);
    }
    [data-theme="dark"] .tint-details{
      background:
        linear-gradient(180deg, rgba(121,192,255,.14), transparent 55%),
        rgba(15,26,46,.92);
    }

    .tint-inputs{
      background:
        linear-gradient(180deg, rgba(31,157,85,.10), transparent 55%),
        rgba(255,250,240,.92);
    }
    [data-theme="dark"] .tint-inputs{
      background:
        linear-gradient(180deg, rgba(126,231,135,.12), transparent 55%),
        rgba(15,26,46,.92);
    }

    .tint-summary{
      background:
        linear-gradient(180deg, rgba(122,75,42,.10), transparent 55%),
        rgba(255,250,240,.92);
    }
    [data-theme="dark"] .tint-summary{
      background:
        linear-gradient(180deg, rgba(210,160,122,.12), transparent 55%),
        rgba(15,26,46,.92);
    }

    .tint-forecast{
      background:
        linear-gradient(180deg, rgba(201,162,39,.12), transparent 60%),
        rgba(255,250,240,.92);
    }
    [data-theme="dark"] .tint-forecast{
      background:
        linear-gradient(180deg, rgba(255,211,106,.10), transparent 60%),
        rgba(15,26,46,.92);
    }

    .card h2{
      margin:0 0 10px;
      font-size: 20px;
      display:flex;
      align-items:center;
      gap: 10px;
    }
    .pill{
      font-size: 12px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 2px solid var(--border);
      background: rgba(255,250,240,.75);
    }
    [data-theme="dark"] .pill{ background: rgba(15,26,46,.75); }

    .form-grid{display:grid; grid-template-columns: 1fr 1fr; gap: 12px;}
    label{display:block; font-size: 14px; color: var(--muted); margin-bottom: 7px;}
    .field{display:flex; flex-direction: column; gap: 4px; min-width: 0;}

    input, select{
      width:100%;
      padding: 13px 13px;
      border-radius: 13px;
      border: 3px solid var(--border);
      background: rgba(255,250,240,.88);
      color: var(--text);
      outline:none;
      font-size: 18px;
      min-height: 52px;
      min-width: 0;
    }
    [data-theme="dark"] input, [data-theme="dark"] select{ background: rgba(15,26,46,.88); }
    input:focus, select:focus{box-shadow: 0 0 0 4px var(--focus);}
    input[disabled]{opacity: .98; cursor: not-allowed;}

    .static-strong input[disabled]{
      font-weight: 950;
      letter-spacing: .3px;
    }

    /* Summary spacing tighter */
    .kv{
      display:grid;
      grid-template-columns: 1fr auto;
      gap: 6px 8px;               /* tighter */
      margin-top: 6px;
      font-size: 16px;
      min-width: 0;
    }
    .kv .k{color: var(--muted); min-width:0;}
    .kv .v{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      white-space: nowrap;        /* keep on one line where possible */
      overflow: hidden;
      text-overflow: ellipsis;
      text-align: right;
      min-width: 0;
      font-size: 16px;
    }

    .tint-summary .kv{ font-size: 18px; }
    .tint-summary .kv .k{
      color:#000;
      opacity:.78;
      font-weight:600;
    }
    .tint-summary .kv .v{
      font-size: 18px;
      color:#000;
      font-weight:650;
    }
    [data-theme="dark"] .tint-summary .kv .k,
    [data-theme="dark"] .tint-summary .kv .v{
      color: var(--text);
      opacity: 1;
    }

    .kv .v.good{color: var(--ok); font-weight: 950}
    .kv .v.bad{color: var(--danger); font-weight: 950}
    .divider{height:1px; background: var(--border2); margin: 12px 0;}

    .tag{
      display:inline-flex; gap: 8px; align-items:center;
      padding: 5px 10px;
      border-radius: 999px;
      border: 2px solid var(--border2);
      background: rgba(255,250,240,.70);
      color: var(--muted);
      font-size: 12px;
    }
    [data-theme="dark"] .tag{ background: rgba(15,26,46,.70); }

    .row{display:flex; align-items:center; justify-content: space-between; gap: 10px; flex-wrap: wrap;}

    .btn{
      appearance:none;
      border: 3px solid var(--border);
      background: rgba(255,250,240,.86);
      color: var(--text);
      border-radius: 14px;
      padding: 12px 16px;
      cursor:pointer;
      font-weight: 950;
      box-shadow: var(--shadow2);
      min-height: 52px;
      touch-action: manipulation;
      user-select:none;
      font-size: 18px;
    }
    [data-theme="dark"] .btn{ background: rgba(15,26,46,.86); }
    .btn:active{transform: translateY(1px)}

    .btn.secondary{
      border-color: rgba(201,162,39,.55);
      font-weight: 850;
    }

    .save-note{
      font-size: 12px;
      color: var(--muted);
      margin-top: 8px;
      line-height: 1.35;
    }

    .error-box{
      display:none;
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 3px solid rgba(180,35,24,.9);
      background: rgba(180,35,24,.10);
      color: var(--text);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 13px;
      white-space: pre-wrap;
      overflow-wrap: anywhere;
    }
    .error-box.show{display:block;}

    table{
      width:100%;
      border-collapse: separate;
      border-spacing: 0;
      overflow:hidden;
      border-radius: 12px;
      border: 3px solid var(--border);
      background: rgba(255,250,240,.88);
      box-shadow: var(--shadow2);
    }
    [data-theme="dark"] table{ background: rgba(15,26,46,.88); }

    th, td{
      padding: 10px 10px;          /* tighter columns */
      text-align:left;
      font-size: 14px;
      border-bottom: 1px solid var(--border2);
      vertical-align: middle;
    }
    th{
      font-size: 12px;
      color: var(--muted);
      background: rgba(255,250,240,.65);
      position: sticky;
      top: 0;
      z-index: 1;
      white-space: nowrap;
    }
    [data-theme="dark"] th{ background: rgba(15,26,46,.65); }

    tr:last-child td{border-bottom:none;}
    td.num{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; white-space: nowrap;}
    .table-wrap{overflow:auto; border-radius: 12px;}

    tr.keyyear td{
      background: rgba(31,111,235,.10);
      border-bottom-color: rgba(31,111,235,.22);
      font-weight: 800;
    }
    [data-theme="dark"] tr.keyyear td{
      background: rgba(121,192,255,.12);
      border-bottom-color: rgba(121,192,255,.22);
    }

    @media (max-width: 980px){
      .two-col{grid-template-columns: 1fr;}
      .form-grid{grid-template-columns: 1fr;}
    }
    @media (max-width: 560px){
      input, select{font-size: 18px; min-height: 54px;}
      .logo-preview{width: 125px; height: 125px;}
      .kv{grid-template-columns: 1fr auto;} /* keep two cols but tighter */
      .kv .v{text-align: right;}
      th, td{padding: 8px 8px; font-size: 13px;}
      th{font-size: 11px;}
    }
  </style>
</head>

<body data-theme="light">
  <header>
    <div class="header-inner">
      <div>
        <h1>Cashflow and Capital growth calculator</h1>
      </div>

      <div class="header-right">
        <button class="icon-btn" id="themeToggle" type="button" aria-label="Toggle theme">
          <span class="icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="4"></circle>
              <path d="M12 2v2M12 20v2M2 12h2M20 12h2M4.9 4.9l1.4 1.4M17.7 17.7l1.4 1.4M19.1 4.9l-1.4 1.4M6.3 17.7l-1.4 1.4"></path>
            </svg>
          </span>
        </button>

        <div class="logo-preview" title="Logo">
          <img alt="Logo" src="data:image/png;base64,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">
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="stack">

      <section class="card tint-details static-strong">
        <div class="row">
          <h2><span style="color:var(--blue)">■</span> Property details </h2>
        </div>

        <div class="form-grid">
          <div class="field">
            <label for="address">Address</label>
            <input id="address" type="text" value="19 Summer Street, Mareeba, Qld 4880" />
          </div>
          <div class="field">
            <label for="purchasePrice">Purchase Price</label>
            <input id="purchasePrice" type="text" value="$650,500" inputmode="decimal" />
          </div>
        </div>

        <div class="save-note" id="templateNote" style="display:none;">
          Template mode: Address and Price are editable. Saved values persist only in this browser (localStorage).
        </div>
      </section>

      <section class="two-col">
        <div class="card tint-inputs">
          <h2><span style="color:var(--green)">■</span> Inputs</h2>

          <div class="form-grid">
            <div class="field">
              <label for="state">State (auto from Address, editable)</label>
              <input id="state" type="text" placeholder="e.g. NSW" />
            </div>

            <div class="field">
              <label for="lvr">LVR</label>
              <input id="lvr" type="text" inputmode="decimal" />
            </div>

            <div class="field">
              <label for="lmi">LMI</label>
              <input id="lmi" type="text" inputmode="decimal" />
              <div style="margin-top:6px;">
                <label style="display:flex;align-items:center;gap:10px;margin:0;color:var(--muted);font-size:14px;">
                  <input id="lmiAuto" type="checkbox" checked style="width:auto;min-height:auto;accent-color:var(--gold);" />
                  Auto-calculate LMI (turn off to override)
                </label>
                <span class="tag" id="lmiModeTag" style="margin-top:8px;display:inline-flex;">Auto</span>
              </div>
            </div>

            <div class="field">
              <label for="stampDuty">Stamp duty (Transfer duty)</label>
              <input id="stampDuty" type="text" inputmode="decimal" />
              <div style="margin-top:6px;">
                <label style="display:flex;align-items:center;gap:10px;margin:0;color:var(--muted);font-size:14px;">
                  <input id="dutyAuto" type="checkbox" checked style="width:auto;min-height:auto;accent-color:var(--gold);" />
                  Turn off to override
                </label>
                <span class="tag" id="dutyModeTag" style="margin-top:8px;display:inline-flex;">Auto</span>
              </div>
            </div>

            <div class="field">
              <label for="interest">Interest</label>
              <input id="interest" type="text" inputmode="decimal" />
            </div>

            <div class="field">
              <label for="rentWeek">Rent/week</label>
              <input id="rentWeek" type="text" inputmode="decimal" />
            </div>

            <div class="field">
              <label for="councilRates">Council Rates</label>
              <input id="councilRates" type="text" inputmode="decimal" />
            </div>

            <div class="field">
              <label for="insurance">Insurance</label>
              <input id="insurance" type="text" inputmode="decimal" />
            </div>

            <div class="field">
              <label for="pmFeePct">Property Management fees %</label>
              <input id="pmFeePct" type="text" inputmode="decimal" />
            </div>

            <div class="field">
              <label for="pmFee">Property Management fees</label>
              <input id="pmFee" type="text" inputmode="decimal" placeholder="auto = Rental income (Yr) × %"/>
              <div style="margin-top:6px;">
                <label style="display:flex;align-items:center;gap:10px;margin:0;color:var(--muted);font-size:14px;">
                  <input id="pmUseFormula" type="checkbox" checked style="width:auto;min-height:auto;accent-color:var(--gold);" />
                  Auto-calculate from % (turn off to override)
                </label>
                <span class="tag" id="pmModeTag" style="margin-top:8px;display:inline-flex;">Auto</span>
              </div>
            </div>

            <div class="field">
              <label for="maintenance">Maintenance</label>
              <input id="maintenance" type="text" inputmode="decimal" />
            </div>

            <div class="field">
              <label for="landTax">Land Tax</label>
              <input id="landTax" type="text" inputmode="decimal" />
            </div>

            <div class="field">
              <label for="depreciation">Depreciation (forced negative)</label>
              <input id="depreciation" type="text" inputmode="decimal" />
            </div>

            <div class="field">
              <label for="taxRate">Tax rate</label>
              <input id="taxRate" type="text" inputmode="decimal" />
            </div>

            <div class="field">
              <label for="capGrowth">Capital Growth Rate</label>
              <input id="capGrowth" type="text" inputmode="decimal" />
            </div>

            <div class="field">
              <label for="rentGrowth">Rent Growth Rate</label>
              <input id="rentGrowth" type="text" inputmode="decimal" />
            </div>
          </div>

          <div class="row" style="margin-top:12px;">
            <button class="btn" id="recalcBtn" type="button">Recalculate</button>
            <button class="btn secondary" id="saveBtn" type="button">Save</button>
            <button class="btn secondary" id="resetBtn" type="button">Reset</button>
          </div>

          <div class="save-note" id="saveStatus"></div>

          <div id="errorBox" class="error-box"></div>
        </div>

        <div class="card tint-summary">
          <h2><span style="color:var(--brown)">■</span> Summary</h2>

          <div class="kv" id="summaryKv">
            <div class="k">Status</div><div class="v">Loading…</div>
          </div>
          <div class="divider"></div>
          <div class="kv" id="yieldKv">
            <div class="k">Status</div><div class="v">Loading…</div>
          </div>
          <div class="divider"></div>
          <div class="kv" id="cashflowKv">
            <div class="k">Status</div><div class="v">Loading…</div>
          </div>
        </div>
      </section>

      <section class="card tint-forecast">
        <div class="row">
          <h2><span style="color:var(--gold)">■</span> Forecast <span class="pill">Compounding</span></h2>

          <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
            <select id="forecastMode" aria-label="Forecast Mode" style="max-width: 280px;">
              <option value="key">Key years (1, 5, 10, 15, 20)</option>
              <option value="all">All years (1–20)</option>
            </select>
          </div>
        </div>

        <div class="table-wrap" style="margin-top:12px;">
          <table>
            <thead>
              <tr>
                <th title="Year: forecast year number">Yr</th>
                <th title="Rent per year (gross): weekly rent × 52">Rent/yr</th>
                <th title="Cashflow After Tax per year">Cashflow after Tax/yr</th>
                <th title="Property Value at start of year (Year 1 = purchase price)">Value</th>
                <th title="Capital Growth dollars for the year (Value × growth rate)">Cap$/yr</th>
                <th title="Accumulated Capital Growth dollars from Year 1 to this year">Acc Cap$</th>
              </tr>
            </thead>
            <tbody id="forecastBody">
              <tr><td class="num">…</td><td colspan="5">Loading…</td></tr>
            </tbody>
          </table>
        </div>
      </section>

    </div>
  </main>

  <script>
    const $ = (id) => document.getElementById(id);
    const STATE_MAP = new Map([["NEW SOUTH WALES","NSW"],["NSW","NSW"],["VICTORIA","VIC"],["VIC","VIC"],["QUEENSLAND","QLD"],["QLD","QLD"],["SOUTH AUSTRALIA","SA"],["SA","SA"],["WESTERN AUSTRALIA","WA"],["WA","WA"],["TASMANIA","TAS"],["TAS","TAS"],["NORTHERN TERRITORY","NT"],["NT","NT"],["AUSTRALIAN CAPITAL TERRITORY","ACT"],["ACT","ACT"]]);
    const DUTY_PURPOSE = "investment"; // investment/home
    const IS_TEMPLATE = false;

    const DEFAULTS = {
      address: "19 Summer Street, Mareeba, Qld 4880",
      purchase: 650500,
      state: "QLD",
      lvr: 0.8,
      interest: 0.056,
      rentWeek: 650,
      council: 4800,
      insurance: 2100,
      pmPct: 8,          // percent number (e.g. 9)
      maintenance: 1000,
      landTax: 0,
      depreciation: -4500,
      taxRate: 0.37,
      capGrowth: 0.07,
      rentGrowth: 0.06,
      lmi: 0,
      stampDuty: 22298,
    };

    const STORAGE_KEY = "cf_calc_v2"; 
    const KEY_YEARS = new Set([1,5,10,15,20]);

    // --- LMI (Approx AU) ---
    const LMI_PREMIUM_DUTY = {
      "NSW": 0.00,"VIC": 0.10,"QLD": 0.09,"SA":  0.11,"WA":  0.10,"ACT": 0.00,"NT":  0.10,"TAS": 0.10,
    };

    const LOAN_BANDS = [
      [0, 300000, "UP_TO_300K"],
      [300000.01, 500000, "300_500"],
      [500000.01, 600000, "500_600"],
      [600000.01, 750000, "600_750"],
      [750000.01, 1000000, "750_1M"],
    ];

    const LMI_RATE_TABLE = [
      { lo: 80.01, hi: 81.00, rates: {"UP_TO_300K": 0.00475, "300_500": 0.00568, "500_600": 0.00904, "600_750": 0.00904, "750_1M": 0.00913} },
      { lo: 81.01, hi: 82.00, rates: {"UP_TO_300K": 0.00485, "300_500": 0.00568, "500_600": 0.00904, "600_750": 0.00904, "750_1M": 0.00913} },
      { lo: 82.01, hi: 83.00, rates: {"UP_TO_300K": 0.00596, "300_500": 0.00699, "500_600": 0.00932, "600_750": 0.01090, "750_1M": 0.01109} },
      { lo: 83.01, hi: 84.00, rates: {"UP_TO_300K": 0.00662, "300_500": 0.00829, "500_600": 0.00960, "600_750": 0.01090, "750_1M": 0.01146} },
      { lo: 84.01, hi: 85.00, rates: {"UP_TO_300K": 0.00727, "300_500": 0.00969, "500_600": 0.01165, "600_750": 0.01333, "750_1M": 0.01407} },
      { lo: 85.01, hi: 86.00, rates: {"UP_TO_300K": 0.00876, "300_500": 0.01081, "500_600": 0.01258, "600_750": 0.01407, "750_1M": 0.01463} },
      { lo: 86.01, hi: 87.00, rates: {"UP_TO_300K": 0.00932, "300_500": 0.01146, "500_600": 0.01407, "600_750": 0.01631, "750_1M": 0.01733} },
      { lo: 87.01, hi: 88.00, rates: {"UP_TO_300K": 0.01062, "300_500": 0.01305, "500_600": 0.01463, "600_750": 0.01631, "750_1M": 0.01752} },
      { lo: 88.01, hi: 89.00, rates: {"UP_TO_300K": 0.01295, "300_500": 0.01621, "500_600": 0.01948, "600_750": 0.02218, "750_1M": 0.02395} },
      { lo: 89.01, hi: 90.00, rates: {"UP_TO_300K": 0.01463, "300_500": 0.01873, "500_600": 0.02180, "600_750": 0.02367, "750_1M": 0.02516} },
      { lo: 90.01, hi: 91.00, rates: {"UP_TO_300K": 0.02013, "300_500": 0.02618, "500_600": 0.03513, "600_750": 0.03783, "750_1M": 0.03820} },
      { lo: 91.01, hi: 92.00, rates: {"UP_TO_300K": 0.02013, "300_500": 0.02674, "500_600": 0.03569, "600_750": 0.03867, "750_1M": 0.03932} },
      { lo: 92.01, hi: 93.00, rates: {"UP_TO_300K": 0.02330, "300_500": 0.03028, "500_600": 0.03802, "600_750": 0.04081, "750_1M": 0.04156} },
      { lo: 93.01, hi: 94.00, rates: {"UP_TO_300K": 0.02376, "300_500": 0.03028, "500_600": 0.03802, "600_750": 0.04286, "750_1M": 0.04324} },
      { lo: 94.01, hi: 95.00, rates: {"UP_TO_300K": 0.02609, "300_500": 0.03345, "500_600": 0.03998, "600_750": 0.04613, "750_1M": 0.04603} },
    ];

    function pickLoanBandKey(loanAmount) {
      for (const [lo, hi, key] of LOAN_BANDS) {
        if (loanAmount >= lo && loanAmount <= hi) return key;
      }
      if (loanAmount > 1000000) return "750_1M";
      return "UP_TO_300K";
    }

    function findLvrRates(lvrPct) {
      for (const row of LMI_RATE_TABLE) {
        if (lvrPct >= row.lo && lvrPct <= row.hi) return row.rates;
      }
      return null;
    }

    function calcLmiApprox(propertyValue, loanAmount, stateCode) {
      if (!propertyValue || propertyValue <= 0 || !loanAmount || loanAmount <= 0) return 0;
      const lvrPct = (loanAmount / propertyValue) * 100.0;
      if (lvrPct <= 80.0) return 0;
      if (lvrPct > 95.0) return null;

      const rates = findLvrRates(lvrPct);
      if (!rates) return 0;

      const loanBandKey = pickLoanBandKey(loanAmount);
      const rate = rates[loanBandKey];
      if (!rate) return 0;

      const premium = rate * loanAmount;
      const dutyRate = LMI_PREMIUM_DUTY[(stateCode || "").toUpperCase()] ?? 0.0;
      const duty = premium * dutyRate;
      return premium + duty;
    }

    // --- Stamp duty ---
    function calcFromScale(price, scale) {
      if (price < 0) return 0;
      for (const b of scale) {
        if (b.upper === null || price <= b.upper) {
          return b.base + b.rate * (price - b.lower);
        }
      }
      return 0;
    }

    function dutyNSW(price) {
      const scale = [
        {upper: 14000, base:0.0, rate:0.0125, lower:0},
        {upper: 30000, base:175.0, rate:0.0150, lower:14000},
        {upper: 80000, base:415.0, rate:0.0175, lower:30000},
        {upper: 300000, base:1290.0, rate:0.0350, lower:80000},
        {upper: 1000000, base:8990.0, rate:0.0450, lower:300000},
        {upper: 3721000, base:40490.0, rate:0.0550, lower:1000000},
        {upper: null, base:186667.0, rate:0.0700, lower:3721000},
      ];
      return calcFromScale(price, scale);
    }

    function dutyVIC(price) {
      if (price > 960000 && price <= 2000000) return 0.055 * price;
      const scale = [
        {upper: 25000, base:0.0, rate:0.0140, lower:0},
        {upper: 130000, base:350.0, rate:0.0240, lower:25000},
        {upper: 960000, base:2870.0, rate:0.0600, lower:130000},
        {upper: 2000000, base:0.0, rate:0.0550, lower:0},
        {upper: null, base:110000.0, rate:0.0650, lower:2000000},
      ];
      return calcFromScale(price, scale);
    }

    function dutyQLD(price, purpose) {
      if ((purpose || "investment") === "home") {
        const scale = [
          {upper: 350000, base:0.0, rate:0.0100, lower:0},
          {upper: 540000, base:3500.0, rate:0.0350, lower:350000},
          {upper: 1000000, base:10150.0, rate:0.0450, lower:540000},
          {upper: null, base:30850.0, rate:0.0575, lower:1000000},
        ];
        return calcFromScale(price, scale);
      }
      const scale = [
        {upper: 5000, base:0.0, rate:0.0, lower:0},
        {upper: 75000, base:0.0, rate:0.0150, lower:5000},
        {upper: 540000, base:1050.0, rate:0.0350, lower:75000},
        {upper: 1000000, base:17325.0, rate:0.0450, lower:540000},
        {upper: null, base:38225.0, rate:0.0575, lower:1000000},
      ];
      return calcFromScale(price, scale);
    }

    function dutySA(price) {
      const scale = [
        {upper: 12000, base:0.0, rate:0.0100, lower:0},
        {upper: 30000, base:120.0, rate:0.0200, lower:12000},
        {upper: 50000, base:480.0, rate:0.0300, lower:30000},
        {upper: 100000, base:1080.0, rate:0.0350, lower:50000},
        {upper: 200000, base:2830.0, rate:0.0400, lower:100000},
        {upper: 250000, base:6830.0, rate:0.0425, lower:200000},
        {upper: 300000, base:8955.0, rate:0.0475, lower:250000},
        {upper: 500000, base:11330.0, rate:0.0500, lower:300000},
        {upper: null, base:21330.0, rate:0.0550, lower:500000},
      ];
      return calcFromScale(price, scale);
    }

    function dutyWA(price) {
      const scale = [
        {upper: 120000, base:0.0, rate:0.0190, lower:0},
        {upper: 150000, base:2280.0, rate:0.0285, lower:120000},
        {upper: 360000, base:3135.0, rate:0.0380, lower:150000},
        {upper: 725000, base:11115.0, rate:0.0475, lower:360000},
        {upper: null, base:28453.0, rate:0.0515, lower:725000},
      ];
      return calcFromScale(price, scale);
    }

    function dutyTAS(price) {
      const scale = [
        {upper: 3000, base:50.0, rate:0.0, lower:0},
        {upper: 25000, base:50.0, rate:0.0175, lower:3000},
        {upper: 75000, base:435.0, rate:0.0225, lower:25000},
        {upper: 200000, base:1560.0, rate:0.0350, lower:75000},
        {upper: 375000, base:5935.0, rate:0.0400, lower:200000},
        {upper: 725000, base:12935.0, rate:0.0425, lower:375000},
        {upper: null, base:27810.0, rate:0.0450, lower:725000},
      ];
      return calcFromScale(price, scale);
    }

    function dutyACT(price, purpose) {
      purpose = (purpose || "investment");
      if (purpose === "home") {
        if (price > 1455000) return 0.0454 * price;
        const scale = [
          {upper: 260000, base:0.0, rate:0.0060, lower:0},
          {upper: 300000, base:1560.0, rate:0.0220, lower:260000},
          {upper: 500000, base:2440.0, rate:0.0340, lower:300000},
          {upper: 750000, base:9240.0, rate:0.0432, lower:500000},
          {upper: 1000000, base:20040.0, rate:0.0590, lower:750000},
          {upper: 1455000, base:34790.0, rate:0.0640, lower:1000000},
          {upper: null, base:0.0, rate:0.0454, lower:0},
        ];
        return calcFromScale(price, scale);
      }
      if (price > 1455000) return 0.0454 * price;
      const scale = [
        {upper: 200000, base:0.0, rate:0.0120, lower:0},
        {upper: 300000, base:2400.0, rate:0.0220, lower:200000},
        {upper: 500000, base:4600.0, rate:0.0340, lower:300000},
        {upper: 750000, base:11400.0, rate:0.0432, lower:500000},
        {upper: 1000000, base:22200.0, rate:0.0590, lower:750000},
        {upper: 1455000, base:36950.0, rate:0.0640, lower:1000000},
        {upper: null, base:0.0, rate:0.0454, lower:0},
      ];
      return calcFromScale(price, scale);
    }

    function dutyNT(price) {
      if (price <= 525000) {
        const V = price / 1000.0;
        const D = (0.06571441 * (V ** 2)) + (15.0 * V);
        return D;
      }
      if (price < 3000000) return 0.0495 * price;
      if (price < 5000000) return 0.0575 * price;
      return 0.0595 * price;
    }

    function calcDuty(stateCode, price, purpose) {
      const st = (stateCode || "").toUpperCase().trim();
      if (!st || !price || price <= 0) return 0;
      if (st === "NSW") return dutyNSW(price);
      if (st === "VIC") return dutyVIC(price);
      if (st === "QLD") return dutyQLD(price, purpose);
      if (st === "SA") return dutySA(price);
      if (st === "WA") return dutyWA(price);
      if (st === "TAS") return dutyTAS(price);
      if (st === "ACT") return dutyACT(price, purpose);
      if (st === "NT") return dutyNT(price);
      return 0;
    }

    function clamp(n, min, max) { return Math.min(Math.max(n, min), max); }

    function toNumberLoose(input) {
      if (input == null) return 0;
      let s = String(input).trim();
      if (!s) return 0;
      s = s.replace(/[\\s,$]/g, "");
      const last = s.slice(-1).toLowerCase();
      if (last === "k" || last === "m") {
        const base = parseFloat(s.slice(0, -1));
        if (Number.isFinite(base)) return last === "k" ? base * 1000 : base * 1000000;
      }
      const n = parseFloat(s);
      return Number.isFinite(n) ? n : 0;
    }

    function parsePercent(input, fallback=0) {
      if (input == null) return fallback;
      let s = String(input).trim();
      if (!s) return fallback;
      s = s.replace(/[%\\s]/g, "");
      const n = parseFloat(s);
      if (!Number.isFinite(n)) return fallback;
      return n / 100;
    }

    function fmtMoney(n) {
      const x = Number.isFinite(n) ? n : 0;
      return x.toLocaleString("en-AU", { style:"currency", currency:"AUD", maximumFractionDigits:0 });
    }

    function fmtPercent(n, decimals=2) {
      const x = Number.isFinite(n) ? n : 0;
      return (x * 100).toFixed(decimals) + "%";
    }

    function normalizeState() {
      const el = $("state");
      const raw = (el.value || "").trim();
      if (!raw) return;
      const key = raw.toUpperCase();
      if (STATE_MAP.has(key)) { el.value = STATE_MAP.get(key); return; }
      const cleaned = key.replace(/\\(.*?\\)/g, "").trim();
      if (STATE_MAP.has(cleaned)) el.value = STATE_MAP.get(cleaned);
    }

    function forceNegative(id) {
      const el = $(id);
      let val = toNumberLoose(el.value);
      if (val > 0) val = -val;
      el.value = fmtMoney(val);
    }

    const themeToggle = $("themeToggle");
    function setTheme(mode) {
      document.body.setAttribute("data-theme", mode);
      try { localStorage.setItem("cf_theme", mode); } catch(e) {}
    }
    function toggleTheme() {
      const cur = document.body.getAttribute("data-theme") || "light";
      setTheme(cur === "light" ? "dark" : "light");
    }
    themeToggle.addEventListener("click", toggleTheme, { passive:true });

    function updateLmiModeTag() {
      const on = $("lmiAuto").checked;
      $("lmiModeTag").textContent = on ? "Auto" : "Manual";
      $("lmi").disabled = on;
    }

    function updateDutyModeTag() {
      const on = $("dutyAuto").checked;
      $("dutyModeTag").textContent = on ? "Auto" : "Manual";
      $("stampDuty").disabled = on;
    }

    function updatePmModeTag() {
      const on = $("pmUseFormula").checked;
      $("pmModeTag").textContent = on ? "Auto" : "Manual";
      $("pmFee").disabled = on;

      const pmPct = clamp(parsePercent($("pmFeePct").value, (DEFAULTS.pmPct / 100.0)), 0, 1);
      const pctText = Math.round(pmPct * 100);
      $("pmFee").setAttribute("placeholder", `auto = Rental income (Yr) × ${pctText}%`);
    }

    $("pmUseFormula").addEventListener("change", () => { updatePmModeTag(); safeRecalc(); });
    $("lmiAuto").addEventListener("change", () => { updateLmiModeTag(); safeRecalc(); });
    $("dutyAuto").addEventListener("change", () => { updateDutyModeTag(); safeRecalc(); });

    function getForecastYears(mode) {
      if (mode === "key") return [1,5,10,15,20];
      const years = [];
      for (let y=1; y<=20; y++) years.push(y);
      return years;
    }
    $("forecastMode").addEventListener("change", () => safeRecalc());

    function getCurrentFormState() {
      return {
        address: $("address").value || "",
        purchasePrice: $("purchasePrice").value || "",
        state: $("state").value || "",
        lvr: $("lvr").value || "",
        lmi: $("lmi").value || "",
        lmiAuto: $("lmiAuto").checked,
        stampDuty: $("stampDuty").value || "",
        dutyAuto: $("dutyAuto").checked,
        interest: $("interest").value || "",
        rentWeek: $("rentWeek").value || "",
        councilRates: $("councilRates").value || "",
        insurance: $("insurance").value || "",
        pmFeePct: $("pmFeePct").value || "",
        pmFee: $("pmFee").value || "",
        pmUseFormula: $("pmUseFormula").checked,
        maintenance: $("maintenance").value || "",
        landTax: $("landTax").value || "",
        depreciation: $("depreciation").value || "",
        taxRate: $("taxRate").value || "",
        capGrowth: $("capGrowth").value || "",
        rentGrowth: $("rentGrowth").value || "",
        forecastMode: $("forecastMode").value || "key",
        theme: document.body.getAttribute("data-theme") || "light",
      };
    }

    function setIfNonEmpty(id, val) {
      if (typeof val !== "string") return;
      const trimmed = val.trim();
      if (!trimmed) return;                 // skip empty strings so defaults remain
      $(id).value = trimmed;
    }

    function applyFormState(s) {
      if (!s || typeof s !== "object") return;

      // Allow address to be empty in template mode
      if (typeof s.address === "string") $("address").value = s.address;

      // Price: allow empty in template mode, otherwise skip blank
      if (typeof s.purchasePrice === "string") {
        if (IS_TEMPLATE) $("purchasePrice").value = s.purchasePrice;
        else if (s.purchasePrice.trim()) $("purchasePrice").value = s.purchasePrice.trim();
      }

      // Everything else: do NOT overwrite defaults with ""
      setIfNonEmpty("state", s.state);
      setIfNonEmpty("lvr", s.lvr);

      if (typeof s.lmiAuto === "boolean") $("lmiAuto").checked = s.lmiAuto;
      setIfNonEmpty("lmi", s.lmi);

      if (typeof s.dutyAuto === "boolean") $("dutyAuto").checked = s.dutyAuto;
      setIfNonEmpty("stampDuty", s.stampDuty);

      setIfNonEmpty("interest", s.interest);
      setIfNonEmpty("rentWeek", s.rentWeek);

      setIfNonEmpty("councilRates", s.councilRates);
      setIfNonEmpty("insurance", s.insurance);
      setIfNonEmpty("pmFeePct", s.pmFeePct);
      if (typeof s.pmUseFormula === "boolean") $("pmUseFormula").checked = s.pmUseFormula;
      setIfNonEmpty("pmFee", s.pmFee);

      setIfNonEmpty("maintenance", s.maintenance);
      setIfNonEmpty("landTax", s.landTax);
      setIfNonEmpty("depreciation", s.depreciation);

      setIfNonEmpty("taxRate", s.taxRate);
      setIfNonEmpty("capGrowth", s.capGrowth);
      setIfNonEmpty("rentGrowth", s.rentGrowth);

      if (typeof s.forecastMode === "string" && s.forecastMode.trim()) {
        $("forecastMode").value = s.forecastMode.trim();
      }

      if (typeof s.theme === "string" && (s.theme === "light" || s.theme === "dark")) {
        setTheme(s.theme);
      }
    }


    function saveToBrowserCache() {
      const status = $("saveStatus");
      try {
        const payload = getCurrentFormState();
        localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
        status.textContent = "Saved to browser cache.";
      } catch (e) {
        status.textContent = "Save failed (browser blocked storage).";
      }
      setTimeout(() => { status.textContent = ""; }, 2500);
    }

    function resetBrowserCache() {
      const status = $("saveStatus");
      try {
        localStorage.removeItem(STORAGE_KEY);
        status.textContent = "Reset: browser cache cleared.";
      } catch (e) {
        status.textContent = "Reset failed.";
      }
      setTimeout(() => { status.textContent = ""; }, 2500);
    }

    $("saveBtn").addEventListener("click", () => { saveToBrowserCache(); safeRecalc(); });
    $("resetBtn").addEventListener("click", () => { resetBrowserCache(); applyDefaults(); safeRecalc(); });

    function applyDefaults() {
      $("address").value = (DEFAULTS.address || "");
      $("purchasePrice").value = fmtMoney(DEFAULTS.purchase);

      $("state").value = (DEFAULTS.state || "");
      $("lvr").value = fmtPercent(DEFAULTS.lvr, 0);
      $("interest").value = fmtPercent(DEFAULTS.interest, 2);
      $("rentWeek").value = fmtMoney(DEFAULTS.rentWeek);
      $("councilRates").value = fmtMoney(DEFAULTS.council);
      $("insurance").value = DEFAULTS.insurance ? fmtMoney(DEFAULTS.insurance) : "";
      $("maintenance").value = fmtMoney(DEFAULTS.maintenance);
      $("landTax").value = fmtMoney(DEFAULTS.landTax);
      $("depreciation").value = fmtMoney(DEFAULTS.depreciation);
      $("taxRate").value = fmtPercent(DEFAULTS.taxRate, 0);
      $("capGrowth").value = fmtPercent(DEFAULTS.capGrowth, 0);
      $("rentGrowth").value = fmtPercent(DEFAULTS.rentGrowth, 0);

      $("lmi").value = fmtMoney(Number(DEFAULTS.lmi || 0));
      $("stampDuty").value = fmtMoney(Number(DEFAULTS.stampDuty || 0));

      $("pmFeePct").value = fmtPercent((DEFAULTS.pmPct / 100.0), 0);
      $("pmUseFormula").checked = true;
      $("pmFee").setAttribute("placeholder", `auto = Rental income (Yr) × ${DEFAULTS.pmPct}%`);

      $("lmiAuto").checked = true;
      $("dutyAuto").checked = true;

      updateLmiModeTag();
      updateDutyModeTag();
      updatePmModeTag();
    }

    function setPropertyFieldsEditable() {
      const addr = $("address");
      const price = $("purchasePrice");

      if (IS_TEMPLATE) {
        addr.disabled = false;
        price.disabled = false;
        $("templateNote").style.display = "block";
      } else {
        addr.disabled = true;
        price.disabled = true;
        $("templateNote").style.display = "none";
      }
    }

    function recalc() {
      // property inputs
      const address = ($("address").value || "").trim();
      let purchase = toNumberLoose($("purchasePrice").value);
      if (!purchase || purchase <= 0) purchase = DEFAULTS.purchase;

      // keep formatted
      $("purchasePrice").value = fmtMoney(purchase);

      // auto state from Address (whenever address contains a valid ending like "NSW 2440")
      if (address) {
        const m = address.match(/,\s*([A-Za-z]{2,3})\s+\d{3,4}\s*$/) || address.match(/\b([A-Za-z]{2,3})\s+\d{3,4}\s*$/);
        if (m && m[1]) {
          $("state").value = m[1].toUpperCase();
        }
      }
      normalizeState();


      const stateCode = ($("state").value || "").trim().toUpperCase();
      const lvr = clamp(parsePercent($("lvr").value, DEFAULTS.lvr), 0, 1);

      // Auto Duty
      let stampDuty = toNumberLoose($("stampDuty").value);
      if ($("dutyAuto").checked) {
        stampDuty = calcDuty(stateCode, purchase, DUTY_PURPOSE);
        $("stampDuty").value = fmtMoney(stampDuty);
      }

      // Auto LMI
      let lmi = toNumberLoose($("lmi").value);
      const loanForLmi = purchase * lvr;
      if ($("lmiAuto").checked) {
        const out = calcLmiApprox(purchase, loanForLmi, stateCode);
        if (out === null) {
          $("lmi").value = "Not supported >95% LVR";
          lmi = 0;
        } else {
          lmi = out;
          $("lmi").value = fmtMoney(lmi);
        }
      }

      const interest = clamp(parsePercent($("interest").value, DEFAULTS.interest), 0, 1);
      const rentWeek0 = toNumberLoose($("rentWeek").value);

      const council = toNumberLoose($("councilRates").value);
      const insurance = toNumberLoose($("insurance").value);
      const maintenance = toNumberLoose($("maintenance").value);
      const landTax = toNumberLoose($("landTax").value);

      let depreciation = toNumberLoose($("depreciation").value);
      if (depreciation > 0) depreciation = -depreciation;

      const taxRate = clamp(parsePercent($("taxRate").value, DEFAULTS.taxRate), 0, 1);
      const capGrowth = clamp(parsePercent($("capGrowth").value, DEFAULTS.capGrowth), 0, 1);
      const rentGrowth = clamp(parsePercent($("rentGrowth").value, DEFAULTS.rentGrowth), 0, 1);

      const deposit = purchase - (purchase * lvr);
      const totalBuyingExpenses = purchase * 5.5 / 100;
      const totalCostBase = purchase + totalBuyingExpenses;
      const loan = purchase * lvr;

      const repaymentIO = (loan + lmi) * interest;

      const rentYr0 = rentWeek0 * 52;

      const pmPct = clamp(parsePercent($("pmFeePct").value, (DEFAULTS.pmPct / 100.0)), 0, 1);
      const pmUseFormula = $("pmUseFormula").checked;
      const pmFee0 = pmUseFormula ? (rentYr0 * pmPct) : toNumberLoose($("pmFee").value);

      if (pmUseFormula) $("pmFee").value = fmtMoney(pmFee0);

      const runningExpenses0 = council + insurance + pmFee0 + maintenance + landTax;
      const totalExpense0 = runningExpenses0 + repaymentIO;

      const grossYield = purchase > 0 ? (rentYr0 / purchase) : 0;
      const netYield = purchase > 0 ? ((rentYr0 - runningExpenses0) / purchase) : 0;

      const cashflowBeforeTax0 = rentYr0 - totalExpense0;
      const taxable0 = cashflowBeforeTax0 + depreciation;
      const tax0 = taxable0 * taxRate;
      const cashflowAfterTax0 = cashflowBeforeTax0 - tax0;

      const annualCapitalGrowthBase = purchase * capGrowth;

      $("summaryKv").innerHTML = `
        <div class="k">Purchase Price</div><div class="v">${fmtMoney(purchase)}</div>
        <div class="k">LVR</div><div class="v">${fmtPercent(lvr, 0)}</div>
        <div class="k">Deposit</div><div class="v">${fmtMoney(deposit)}</div>
        <div class="k">Loan</div><div class="v">${fmtMoney(loan)}</div>
        <div class="k">Interest</div><div class="v">${fmtPercent(interest, 2)}</div>
        <div class="k">Repayment (IO / Yr)</div><div class="v">${fmtMoney(repaymentIO)}</div>

        <div class="k">LMI</div><div class="v">${($("lmi").value.includes("Not supported") ? $("lmi").value : fmtMoney(lmi))}</div>
        <div class="k">Stamp duty</div><div class="v">${fmtMoney(stampDuty)}</div>
        <div class="k">Buying exp (5.5%)</div><div class="v">${fmtMoney(totalBuyingExpenses)}</div>
        <div class="k">Total cost base</div><div class="v">${fmtMoney(totalCostBase)}</div>
      `;

      // Added fields in relevant area (expenses/yield block)
      $("yieldKv").innerHTML = `
        <div class="k">Rent/week</div><div class="v">${fmtMoney(rentWeek0)}</div>
        <div class="k">Rent (Yr)</div><div class="v">${fmtMoney(rentYr0)}</div>

        <div class="k">Council Rates</div><div class="v">${fmtMoney(council)}</div>
        <div class="k">Insurance</div><div class="v">${fmtMoney(insurance)}</div>
        <div class="k">Property Management fees</div><div class="v">${fmtMoney(pmFee0)}</div>
        <div class="k">Maintenance</div><div class="v">${fmtMoney(maintenance)}</div>
        <div class="k">Land Tax</div><div class="v">${fmtMoney(landTax)}</div>

        <div class="k">Running Exp</div><div class="v">${fmtMoney(runningExpenses0)}</div>
        <div class="k">Total Exp</div><div class="v">${fmtMoney(totalExpense0)}</div>

        <div class="k">Gross yield</div><div class="v">${fmtPercent(grossYield, 2)}</div>
        <div class="k">Net yield</div><div class="v">${fmtPercent(netYield, 2)}</div>
      `;

      const cfClass = cashflowAfterTax0 >= 0 ? "good" : "bad";
      $("cashflowKv").innerHTML = `
        <div class="k">Cashflow Before tax</div><div class="v ${cashflowBeforeTax0>=0 ? "good":"bad"}">${fmtMoney(cashflowBeforeTax0)}</div>
        <div class="k">Depreciation</div><div class="v">${fmtMoney(depreciation)}</div>
        <div class="k">Taxable</div><div class="v">${fmtMoney(taxable0)}</div>
        <div class="k">Tax rate</div><div class="v">${fmtPercent(taxRate, 0)}</div>
        <div class="k">Tax</div><div class="v">${fmtMoney(tax0)}</div>
        <div class="k"><b>Cashflow after tax</b></div><div class="v ${cfClass}"><b>${fmtMoney(cashflowAfterTax0)}</b></div>
        <div class="k">Cap growth (Yr1 base)</div><div class="v">${fmtMoney(annualCapitalGrowthBase)}</div>
      `;

      // Forecast: Year 1 = current year (no growth applied)
      const mode = $("forecastMode").value;
      const yearsToShow = getForecastYears(mode);

      let body = "";
      let propValue = purchase;
      let accCap = 0;

      for (let y = 1; y <= 20; y++) {
        const exponent = (y - 1);

        const rentWeekY = rentWeek0 * Math.pow(1 + rentGrowth, exponent);
        const rentYrY = rentWeekY * 52;

        const pmFeeY = pmUseFormula ? (rentYrY * pmPct) : pmFee0;

        const runningY = council + insurance + pmFeeY + maintenance + landTax;
        const totalExpY = runningY + repaymentIO;

        const cfBeforeY = rentYrY - totalExpY;
        const taxableY = cfBeforeY + depreciation;
        const taxY = taxableY * taxRate;
        const cfAfterY = cfBeforeY - taxY;

        const annualCapGrowthY = propValue * capGrowth;
        accCap += annualCapGrowthY;

        if (yearsToShow.includes(y)) {
          const rowClass = (mode === "all" && KEY_YEARS.has(y)) ? "keyyear" : "";
          body += `
            <tr class="${rowClass}">
              <td class="num">${y}</td>
              <td class="num">${fmtMoney(rentYrY)}</td>
              <td class="num" style="font-weight:950; color:${cfAfterY>=0 ? "var(--ok)" : "var(--danger)"}">
                ${fmtMoney(cfAfterY)}
              </td>
              <td class="num">${fmtMoney(propValue)}</td>
              <td class="num">${fmtMoney(annualCapGrowthY)}</td>
              <td class="num">${fmtMoney(accCap)}</td>
            </tr>
          `;
        }

        propValue = propValue + annualCapGrowthY;
      }
      $("forecastBody").innerHTML = body;

      $("lvr").value = fmtPercent(lvr, 0);
      $("interest").value = fmtPercent(interest, 2);
      $("taxRate").value = fmtPercent(taxRate, 0);
      $("capGrowth").value = fmtPercent(capGrowth, 0);
      $("rentGrowth").value = fmtPercent(rentGrowth, 0);

      updatePmModeTag();
      updateLmiModeTag();
      updateDutyModeTag();
    }

    function safeRecalc() {
      try {
        const box = $("errorBox");
        box.textContent = "";
        box.classList.remove("show");
        recalc();
      } catch (e) {
        const box = $("errorBox");
        const msg = (e && (e.stack || e.message)) ? (e.stack || e.message) : String(e);
        box.textContent = "JavaScript error:\\n" + msg;
        box.classList.add("show");
      }
    }

    $("recalcBtn").addEventListener("click", safeRecalc);
    $("state").addEventListener("blur", () => { normalizeState(); safeRecalc(); });
    $("depreciation").addEventListener("blur", () => { forceNegative("depreciation"); safeRecalc(); });

    // Recalc on address/price changes too (template mode)
    $("address").addEventListener("blur", () => safeRecalc());
    $("purchasePrice").addEventListener("blur", () => safeRecalc());

    let t = null;
    function debounceRecalc() {
      if (t) clearTimeout(t);
      t = setTimeout(() => safeRecalc(), 250);
    }

    [
      "address","purchasePrice",
      "rentWeek","capGrowth","rentGrowth","interest","taxRate",
      "councilRates","insurance","maintenance","landTax",
      "lmi","stampDuty","pmFeePct","pmFee","lvr","state"
    ].forEach(id => $(id).addEventListener("input", debounceRecalc));

    function initRun() {
      try {
        const savedTheme = localStorage.getItem("cf_theme");
        if (savedTheme === "dark" || savedTheme === "light") setTheme(savedTheme);
      } catch(e) {}

      setPropertyFieldsEditable();
      applyDefaults();

      // load saved values (browser cache only)
      // IMPORTANT: In non-template mode, do NOT let saved cache override address/price from the generated HTML
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) {
          const obj = JSON.parse(raw);

          if (!IS_TEMPLATE) {
            // Keep injected address/price fixed (locked)
            if (obj && typeof obj === "object") {
              delete obj.address;
              delete obj.purchasePrice;
            }
          }

          applyFormState(obj);
        }
      } catch(e) {}

      // forecast mode default: key on mobile
      if (!($("forecastMode").value || "").trim()) {
        $("forecastMode").value = (window.matchMedia("(max-width: 560px)").matches ? "key" : "all");
      }

      updatePmModeTag();
      updateLmiModeTag();
      updateDutyModeTag();
      safeRecalc();
    }

    document.addEventListener("DOMContentLoaded", initRun);
    window.addEventListener("load", initRun);
    setTimeout(initRun, 150);
    setTimeout(initRun, 600);
  </script>
</body>
</html>
